# linux

linux安全检查
Mail:liuquyong112@gmail.com

我们在做主机安全检查或安全事件处置时，避免不了要去检查系统的安全情况。在进行 Linux 安全检查时，需要使用相关的脚本对系统的安全情况进行全面分析：

- 一方面需要尽可能的收集系统的相关信息
- 另一方面在数量较多的时候尽可能的提高效率

由于在多次的安全检查中遇到检查时都是几十台服务器要做一个全面检查的场景，如果人工手写脚本的话，一方面效率较低另一方面需要安全检查者熟悉所需要检查的项。在这种情况下，本人写了一个 Linux 安全检查的脚本，该脚本主要在以下场景使用:

1. Linux 主机安全检查时
2. Linux 主机发生安全事件需要全面分析时

## 脚本说明

1. 将本目录所有文件都放入到一台自己的本地linux主机同一目录下
2. 将服务器IP、普通账号、普通账号密码、root密码依次按以下格式写入到hosts.txt中（注意“:”作为hosts.txt的分隔符）：
    - 192.168.1.81:user:123456:nothing
    - 192.168.1.10:user:123456:nothing
    - 192.168.1.11:user:123456:nothing
3. 执行sh login.sh,脚本将自动批量上传checklinux.sh到服务器/tmp目录下，并且自动执行和自动上传结果到本地linux主机上
4. 最后将服务器上传的脚本和结果自动删除

checkrulues: 部分判断逻辑,这里面目前仅有端口的判断逻辑,后期可以将进程、应用程序是否有漏洞等逻辑放在这里面进行安全检查,比较简单的判断逻辑直接在 buying_linuxcheck.sh 中可以实现

```shell
buying_linuxcheck.sh: 核心检查逻辑

del.exp: 删除远程服务器上的脚本与检查结果

get.exp: 获取远程服务器上安全检查的结果

hosts.txt:需要被检查的服务器列表

login.sh:一键进行登录检查,安全检查时只需要运行该脚本即可

put.exp:将安全检查脚本上传到远程服务器上

readme.txt:使用相关说明文档

sh.exp:在远程服务器上执行安全检查脚本
```

(注意：本脚本适用于linux系统)

## 检查内容

### 整体框架

关于 Linux 安全检查,这里面我总结主要需要检查以下内容:

1. 系统安全检查(进程、开放端口、连接、日志等)
    - 这一块是目前个人该脚本所实现的功能
2. Rootkit
    - 建议使用 rootkit 专杀工具来检查,如 rkhunter
3. Webshell
    - 这一块查杀技术难度相对较高，不是本脚本所需要实现的功能
    - 针对这一块的检查可以使用`D盾`来检查(Linux 下可以将 web 目录挂载到 Windows 下进行检查)
4. Web日志
5. 流量
    - 这一块主要侧重主机的长期的流量分析,目前个人使用 tshark 实现了基础的流量分析，后期会进行相应的完善。
    - 流量这一块可以提取流量五元组、DNS 流量、HTTP 流量再结合威胁情报的数据进行深度分析。
    - 这个后期个人会进行相关的尝试，可能的话会进行相应内容的分享。

### 系统安全检查框架

![toc](https://img2018.cnblogs.com/blog/1127869/201905/1127869-20190519081655539-153631561.jpg)

### 功能实现

功能设计:

- V1.0 主要功能用来采集信息 
- V1.1 主要功能将原始数据进行分析,并找出存在可疑或危险项
- V1.2 增加基线检查的功能
- V1.3 可以进行相关危险项或可疑项的自动处理

PS：目前到 V1.2 版本，后期完善 V1.3 相关的功能。
> 另外，操作上可以实现一键进行安全检查，并将检查后的结果保存到本机。只需要在hosts文本中输入相应的IP、账号、密码。操作上人工参与最小化

